<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Securing your GraphQL API with Hasura</title>
<meta name="author" content="David A. Ventimiglia"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/black.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/lib/css/zenburn.css"/></head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="./assets/slide_background.png"><h1 class="title">Securing your GraphQL API with Hasura</h1><p class="subtitle"><a href="https://hasura.io/events/hasura-con-2022/">HasuraCon 2022</a></p>

</section>

<section>
<section id="slide-orge14f9e3" data-background="./assets/slide_background.png">
<h2 id="orge14f9e3"></h2>

<div id="org3b5c087" class="figure">
<p><img src="assets/qr.png" alt="qr.png" height="50%" width="50%" />
</p>
<p><span class="figure-number">Figure 1: </span><a href="https://tinyurl.com/43vxsdmj">https://tinyurl.com/43vxsdmj</a></p>
</div>

</section>
</section>
<section>
<section id="slide-org46fdf3c" data-background="./assets/slide_background.png">
<h2 id="org46fdf3c">Introduction</h2>
<div class="outline-text-2" id="text-org46fdf3c">
</div>
</section>
<section id="slide-org6ffca60" data-background="./assets/slide_background.png">
<h3 id="org6ffca60">Program</h3>
<ul>
<li><a href="https://hasura.io/docs/latest/graphql/core/auth/index/"><del>Hasura Authentication</del></a></li>
<li><a href="https://hasura.io/docs/latest/graphql/cloud/security/api-limits/">Hasura API Limits</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/auth/authorization/permission-rules/">Hasura Authorization</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/cloud/security/allow-lists/">Hasura Allow Lists</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/api-reference/restified/">Hasura REST Endpoints</a></li>

</ul>

<aside class="notes">
<p>
Note that we don't illustrate authentication in this talk, though we
will touch on it briefly.
</p>

</aside>

</section>
<section id="slide-org32b587c" data-background="./assets/slide_background.png">
<h3 id="org32b587c">Principles</h3>
<dl>
<dt>Risk Management</dt><dd><i>Life is about trade-offs.</i></dd>
<dt>Goal Setting</dt><dd><i>Confidentiality, Integrity, Availability</i></dd>
<dt>Defense in Depth</dt><dd><i>Bottom-Up</i></dd>
<dt>Simplicity</dt><dd><i>Complexity is the Enemy of Security</i></dd>
<dt>Least Privilege</dt><dd><i>The most secure API does nothing at all.</i></dd>

</dl>

</section>
<section id="slide-org5bd2e17" data-background="./assets/slide_background.png">
<h3 id="org5bd2e17">Threats</h3>
<div class="column" style="float:left; width:75%">

<dl>
<dt>Deep Queries</dt><dd><i>Confidentiality, Availability</i></dd>
<dt>Recursive Queries</dt><dd><i>Availability</i></dd>
<dt>Unbounded Queries</dt><dd><i>Confidentiality, Availability</i></dd>
<dt>Malicious Queries</dt><dd><i>Confidentiality</i></dd>
<dt>Batch Requests</dt><dd><i>Confidentiality, Availability</i></dd>

</dl>

</div>

<div class="column" style="float:right; width:25%;">


<div id="org31f4a5f" class="figure">
<p><img src="assets/GraphQL Logo (Rhodamine).svg" alt="GraphQL Logo (Rhodamine).svg" class="org-svg" />
</p>
</div>

</div>

</section>
<section id="slide-orgd3746aa" data-background="./assets/slide_background.png">
<h3 id="orgd3746aa">Deep Queries / Recursive Queries</h3>
<div class="org-src-container">

<pre   ><code class="graphql" >query {
  author(id: 42) {
    posts {
      author {...and so on...
      }
    }
  }
}
</code></pre>
</div>

</section>
<section id="slide-orga308527" data-background="./assets/slide_background.png">
<h3 id="orga308527">Unbounded / Large Queries</h3>
<div class="org-src-container">

<pre   ><code class="graphql" >query {
  authors(first: 1000) {
    name
    posts(last: 100) {
      title
      content
    }
  }
}
</code></pre>
</div>

</section>
<section id="slide-org6d88259" data-background="./assets/slide_background.png">
<h3 id="org6d88259">Malicious Queries</h3>
<div class="org-src-container">

<pre   ><code class="graphql" >query User {
  user (id: "User*") {
    email
    id 
  }
}
</code></pre>
</div>

</section>
<section id="slide-org81dfb3b" data-background="./assets/slide_background.png">
<h3 id="org81dfb3b">Batch Requests</h3>
<div class="org-src-container">

<pre   ><code class="graphql" >query MaliciousQuery {
  alias1: fieldName { subField1 subField2 ...}
  alias2: fieldName { subField1 subField2 ...}
  ...
  alias10: fieldName { subField1 subField2 ...}
  ...
  alias100: fieldName { subField1 subField2 ...
  ...
  alias1000: fieldName { subField1 subField2 ...}
  ...
}
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org8556b45" data-background="./assets/slide_background.png">
<h2 id="org8556b45">Workshop</h2>
<div class="outline-text-2" id="text-org8556b45">
</div>
</section>
<section id="slide-org7720fae" data-background="./assets/slide_background.png">
<h3 id="org7720fae">Log into Heroku</h3>

<div id="org9ef88f2" class="figure">
<p><img src="assets/log_into_heroku.png" alt="log_into_heroku.png" height="40%" width="40%" />
</p>
</div>

</section>
<section id="slide-orge4ac883" data-background="./assets/slide_background.png">
<h3 id="orge4ac883">Log into Hasura Cloud</h3>

<div id="org9c4733e" class="figure">
<p><img src="assets/log_into_hasura_cloud.png" alt="log_into_hasura_cloud.png" height="40%" width="40%" />
</p>
</div>

</section>
<section id="slide-orgfaab6ce" data-background="./assets/slide_background.png">
<h3 id="orgfaab6ce">Create a new Hasura Cloud Project</h3>

<div id="orgc6d789e" class="figure">
<p><img src="assets/create_new_hasura_project.png" alt="create_new_hasura_project.png" height="40%" width="40%" />
</p>
</div>

</section>
<section id="slide-orgef241e9" data-background="./assets/slide_background.png">
<h3 id="orgef241e9">Create a new Heroku database</h3>

</section>
<section id="slide-orgb7bdc53" data-background="./assets/slide_background.png">
<h3 id="orgb7bdc53"><del>Connect to the database</del></h3>
<div class="org-src-container">

<pre   ><code class="shell" >psql -h &lt;hostname&gt; -p &lt;port&gt; -d &lt;db&gt; -U &lt;username&gt; psql
heroku psql -a &lt;app&gt;
</code></pre>
</div>

</section>
<section id="slide-orga0e86d8" data-background="./assets/slide_background.png">
<h3 id="orga0e86d8"><del>Secure the DB</del></h3>
<ul>
<li>Create a dedicated DB user for PROD.</li>
<li><code>REVOKE</code> DML (maybe).</li>
<li><code>REVOKE</code> DDL (definitely).</li>
<li>Use a <a href="https://hasura.io/docs/latest/graphql/core/getting-started/docker-simple/">separate dev instance</a> with elevated permissions for data modeling.</li>
<li>Use an env var like <code>PG_DATABASE_URL</code> with your Hasuras.</li>

</ul>

</section>
<section id="slide-orga0e86d8-split" data-background="./assets/slide_background.png">

<div class="org-src-container">

<pre   ><code class="sql" >-- Read-only? (not on Heroku hobby tier!)
CREATE USER hasuraprod WITH PASSWORD 'hasuraprod';
GRANT CONNECT ON DATABASE &lt;db&gt; TO hasuraprod;
GRANT USAGE ON SCHEMA &lt;schema&gt; TO hasuraprod;
GRANT SELECT ON ALL TABLES IN SCHEMA &lt;schema&gt; TO hasuraprod;
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA &lt;schema&gt; TO hasuraprod;
</code></pre>
</div>

</section>
<section id="slide-org8bff647" data-background="./assets/slide_background.png">
<h3 id="org8bff647">Secure the Service</h3>
<ul>
<li><code>HASURA_GRAPHQL_ADMIN_SECRET</code></li>

</ul>

</section>
<section id="slide-orgf276c70" data-background="./assets/slide_background.png">
<h3 id="orgf276c70"><del>Add Authentication</del></h3>
<ul>
<li><code>HASURA_GRAPHQL_AUTH_HOOK</code></li>
<li><code>HASURA_GRAPHQL_AUTH_HOOK_MODE</code></li>

</ul>

</section>
<section id="slide-orgfdf463d" data-background="./assets/slide_background.png">
<h3 id="orgfdf463d"><del>Disable Hasura Console</del></h3>
<ul>
<li><code>HASURA_GRAPHQL_ENABLE_CONSOLE</code></li>

</ul>

</section>
<section id="slide-org159eb98" data-background="./assets/slide_background.png">
<h3 id="org159eb98">Disable Schema Introspection</h3>

<div id="orgfc9c514" class="figure">
<p><img src="assets/disable_schema_introspection.png" alt="disable_schema_introspection.png" height="80%" width="80%" />
</p>
</div>

</section>
<section id="slide-org0ffb8c9" data-background="./assets/slide_background.png">
<h3 id="org0ffb8c9">Create the Data Model</h3>
<p>
#+INCLUDE "./init<sub>data.sql</sub>" src sql
</p>

</section>
<section id="slide-orgd19b24e" data-background="./assets/slide_background.png">
<h3 id="orgd19b24e">Set API Limits</h3>

<div id="orgc97ec2b" class="figure">
<p><img src="assets/set_api_limits.png" alt="set_api_limits.png" height="80%" width="80%" />
</p>
</div>

</section>
<section id="slide-orgef416c7" data-background="./assets/slide_background.png">
<h3 id="orgef416c7">Apply Permissions</h3>

</section>
<section id="slide-org3b1e429" data-background="./assets/slide_background.png">
<h3 id="org3b1e429">Use Allow Lists</h3>

</section>
<section id="slide-org7e08b0a" data-background="./assets/slide_background.png">
<h3 id="org7e08b0a">Create REST Endpoints</h3>

</section>
</section>
<section>
<section id="slide-org176e093" data-background="./assets/slide_background.png">
<h2 id="org176e093">Discussion</h2>
<div class="outline-text-2" id="text-org176e093">
</div>
</section>
<section id="slide-org7f20fca" data-background="./assets/slide_background.png">
<h3 id="org7f20fca">GraphQL Security Orthodoxy</h3>
<p>
AKA: rituals, cargo cults, security theater which you can get anywhere
</p>
<ul>
<li>Disable Console Access</li>
<li>Disable Schema Introspection</li>
<li>Disable Query Suggestions (unnecessary in Hasura)</li>
<li>Impose API Limits</li>
<li>Whitelist Operations</li>

</ul>

</section>
<section id="slide-org021b1a0" data-background="./assets/slide_background.png">
<h3 id="org021b1a0">GraphQL Security Heterodoxy</h3>
<p>
AKA: possibly controversial opinions which you will get from me
</p>
<ul>
<li>Don't confuse public vs private:</li>
<li>If you don't <i>need</i> to provide a public API, then don't.</li>
<li>If you're not providing a public API, then don't act like you are.</li>
<li>Don't disable console access</li>
<li>If you applied the security principles carefully, deliberately, thoughtfully, then the console can't do anything unauthorized anyway.</li>
<li>Don't disable schema introspection and query suggestions.</li>
<li>The public will need to know how to use your public API (which you almost certainly shouldn't have anyway)</li>
<li>The public shouldn't have access to your private API (you did secure your API, add authentication, disable unauthorized access, build a rich data model, and apply fine-grained authorization, didn't you?)</li>
<li>The information will get out anyway.</li>
<li>Don't use GraphQL security</li>
<li>Or at least, don't rely on it.</li>
<li>Work diligently from the bottom-up, applying the principles carefully, deliberately, thoughtfully, and you (almost) won't need it.</li>
<li>Remember "managing risk", "cargo cults", and "security theater".</li>

</ul>
<p>
Life is about trade-offs.
</p>
<ul>
<li>Don't use GraphQL</li>
<li>For private APIs, that is.</li>
<li>Use Allow Lists.</li>
<li>And if you're using Allow Lists, you might as well use REST endpoints.</li>
<li>GraphQL is for <i>people</i> (i.e. developers), not for machines.</li>

</ul>

</section>
</section>
<section>
<section id="slide-org7ae5d8b" data-background="./assets/slide_background.png">
<h2 id="org7ae5d8b">Closing Remarks</h2>
<div class="outline-text-2" id="text-org7ae5d8b">
</div>
</section>
<section id="slide-org1d6d991" data-background="./assets/slide_background.png">
<h3 id="org1d6d991">References</h3>

</section>
<section id="slide-orga909027" data-background="./assets/slide_background.png">
<h3 id="orga909027">How and where to get help</h3>
<p>
white<sub>check</sub><sub>mark</sub>
100
raised<sub>hands</sub>
</p>
</section>
</section>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/highlight/highlight.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealHighlight],
transition:'none', controlsLayout:'edges', progress:false, controlsTutorial:false
});

</script>
</body>
</html>
