<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Securing your GraphQL API with Hasura</title>
<meta name="author" content="David A. Ventimiglia"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/black.css" id="theme"/>

</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="./assets/slide_background.png"><h1 class="title">Securing your GraphQL API with Hasura</h1><p class="subtitle"><a href="https://hasura.io/events/hasura-con-2022/">HasuraCon 2022</a></p>

</section>

<section>
<section id="slide-org5d15fe7" data-background="./assets/slide_background.png">
<h2 id="org5d15fe7"></h2>

<div id="orge4133ef" class="figure">
<p><img src="assets/qr.png" alt="qr.png" height="50%" width="50%" />
</p>
<p><span class="figure-number">Figure 1: </span><a href="https://tinyurl.com/43vxsdmj">https://tinyurl.com/43vxsdmj</a></p>
</div>

</section>
</section>
<section>
<section id="slide-orgcc2b5c0" data-background="./assets/slide_background.png">
<h2 id="orgcc2b5c0">Introduction</h2>
<div class="outline-text-2" id="text-orgcc2b5c0">
</div>
</section>
<section id="slide-orgaed3aea" data-background="./assets/slide_background.png">
<h3 id="orgaed3aea">Program</h3>
<ul>
<li><a href="https://hasura.io/docs/latest/graphql/cloud/security/api-limits/">Hasura API Limits</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/auth/authorization/permission-rules/">Hasura Permissions</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/cloud/security/allow-lists/">Hasura Allow Lists</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/api-reference/restified/">Hasura REST Endpoints</a></li>

</ul>

<aside class="notes">
<p>
This is a note
</p>

</aside>

</section>
<section id="slide-org8ff7098" data-background="./assets/slide_background.png">
<h3 id="org8ff7098">Principles</h3>
<dl>
<dt>Risk Management</dt><dd><i>Life is about trade-offs.</i></dd>
<dt>Goal Setting</dt><dd><i>Confidentiality, Integrity, Availability</i></dd>
<dt>Defense in Depth</dt><dd><i>Bottom-Up</i></dd>
<dt>Simplicity</dt><dd><i>Complexity is the Enemy of Security</i></dd>
<dt>Least Privilege</dt><dd><i>The most secure API does nothing at all.</i></dd>

</dl>

</section>
<section id="slide-org8a3d84b" data-background="./assets/slide_background.png">
<h3 id="org8a3d84b">Threats</h3>
<div class="column" style="float:left; width:75%">

<dl>
<dt>Deep Queries</dt><dd><i>Confidentiality, Availability</i></dd>
<dt>Recursive Queries</dt><dd><i>Availability</i></dd>
<dt>Unbounded Queries</dt><dd><i>Confidentiality, Availability</i></dd>
<dt>Batch Requests</dt><dd><i>Confidentiality, Availability</i></dd>

</dl>

</div>

<div class="column" style="float:right; width:25%;">


<div id="orgd04f492" class="figure">
<p><img src="assets/GraphQL Logo (Rhodamine).svg" alt="GraphQL Logo (Rhodamine).svg" class="org-svg" />
</p>
</div>

</div>

</section>
<section id="slide-org01b830d" data-background="./assets/slide_background.png">
<h3 id="org01b830d">Application</h3>
<ul>
<li><a href="https://hasura.io/docs/latest/graphql/core/deployment/postgres-requirements/"><del>Secure the DB</del></a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/deployment/securing-graphql-endpoint/">Secure the Service</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/auth/authentication/index/"><del>Add Authentication</del></a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/deployment/graphql-engine-flags/reference/"><del>Disable Hasura Console</del></a></li>
<li><a href="https://hasura.io/docs/latest/graphql/cloud/security/disable-graphql-introspection/">Disable Schema Introspection</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/cloud/security/api-limits/">Set API Limits</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/auth/authorization/permission-rules/">Apply Permissions</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/deployment/allow-list/">Use Allow Lists</a></li>
<li><a href="https://hasura.io/docs/latest/graphql/core/api-reference/restified/">Create REST Endpoints</a></li>

</ul>

</section>
</section>
<section>
<section id="slide-org15a299c" data-background="./assets/slide_background.png">
<h2 id="org15a299c">Workshop</h2>
<div class="outline-text-2" id="text-org15a299c">
</div>
</section>
<section id="slide-org79695e7" data-background="./assets/slide_background.png">
<h3 id="org79695e7">Log into Heroku</h3>

<div id="orgbf7616b" class="figure">
<p><img src="assets/log_into_heroku.png" alt="log_into_heroku.png" height="40%" width="40%" />
</p>
</div>

</section>
<section id="slide-org7e22e0e" data-background="./assets/slide_background.png">
<h3 id="org7e22e0e">Log into Hasura Cloud</h3>

<div id="org17205cd" class="figure">
<p><img src="assets/log_into_hasura_cloud.png" alt="log_into_hasura_cloud.png" height="40%" width="40%" />
</p>
</div>

</section>
<section id="slide-orgb260023" data-background="./assets/slide_background.png">
<h3 id="orgb260023">Create a new Hasura Cloud Project</h3>

<div id="org9621c2b" class="figure">
<p><img src="assets/create_new_hasura_project.png" alt="create_new_hasura_project.png" height="40%" width="40%" />
</p>
</div>

</section>
<section id="slide-org1e88583" data-background="./assets/slide_background.png">
<h3 id="org1e88583">Create a new Heroku database</h3>

</section>
<section id="slide-orgbe52136" data-background="./assets/slide_background.png">
<h3 id="orgbe52136"><del>Connect to the database</del></h3>
<div class="org-src-container">

<pre  class="src src-shell"   ><code trim>psql -h &lt;hostname&gt; -p &lt;port&gt; -d &lt;db&gt; -U &lt;username&gt; psql
heroku psql -a &lt;app&gt;
</code></pre>
</div>

</section>
<section id="slide-org4fbb5e5" data-background="./assets/slide_background.png">
<h3 id="org4fbb5e5"><del>Secure the DB</del></h3>
<ul>
<li>Create a dedicated DB user for PROD.</li>
<li><code>REVOKE</code> DML (maybe).</li>
<li><code>REVOKE</code> DDL (definitely).</li>
<li>Use a <a href="https://hasura.io/docs/latest/graphql/core/getting-started/docker-simple/">separate dev instance</a> with elevated permissions for data modeling.</li>
<li>Use an env var like <code>PG_DATABASE_URL</code> with your Hasuras.</li>

</ul>

</section>
<section id="slide-org4fbb5e5-split" data-background="./assets/slide_background.png">

<div class="org-src-container">

<pre  class="src src-sql"   ><code trim>-- Read-only? (not on Heroku hobby tier!)
CREATE USER hasuraprod WITH PASSWORD 'hasuraprod';
GRANT CONNECT ON DATABASE &lt;db&gt; TO hasuraprod;
GRANT USAGE ON SCHEMA &lt;schema&gt; TO hasuraprod;
GRANT SELECT ON ALL TABLES IN SCHEMA &lt;schema&gt; TO hasuraprod;
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA &lt;schema&gt; TO hasuraprod;
</code></pre>
</div>

</section>
<section id="slide-org2ca375c" data-background="./assets/slide_background.png">
<h3 id="org2ca375c">Secure the Service</h3>
<ul>
<li><code>HASURA_GRAPHQL_ADMIN_SECRET</code></li>

</ul>

</section>
<section id="slide-orgc65b29b" data-background="./assets/slide_background.png">
<h3 id="orgc65b29b"><del>Add Authentication</del></h3>
<ul>
<li><code>HASURA_GRAPHQL_AUTH_HOOK</code></li>
<li><code>HASURA_GRAPHQL_AUTH_HOOK_MODE</code></li>

</ul>

</section>
<section id="slide-orgefdf415" data-background="./assets/slide_background.png">
<h3 id="orgefdf415"><del>Disable Hasura Console</del></h3>
<ul>
<li><code>HASURA_GRAPHQL_ENABLE_CONSOLE</code></li>

</ul>

</section>
<section id="slide-orgb843e47" data-background="./assets/slide_background.png">
<h3 id="orgb843e47">Disable Schema Introspection</h3>

<div id="org18fce38" class="figure">
<p><img src="assets/disable_schema_introspection.png" alt="disable_schema_introspection.png" height="80%" width="80%" />
</p>
</div>

</section>
<section id="slide-orgff6b9ee" data-background="./assets/slide_background.png">
<h3 id="orgff6b9ee">Create a Securable Data Model</h3>

</section>
<section id="slide-org1f1b9df" data-background="./assets/slide_background.png">
<h3 id="org1f1b9df">Set API Limits</h3>

<div id="org8539c87" class="figure">
<p><img src="assets/set_api_limits.png" alt="set_api_limits.png" height="80%" width="80%" />
</p>
</div>

</section>
<section id="slide-org4d33169" data-background="./assets/slide_background.png">
<h3 id="org4d33169">Apply Permissions</h3>

</section>
<section id="slide-orgd1f3c24" data-background="./assets/slide_background.png">
<h3 id="orgd1f3c24">Use Allow Lists</h3>

</section>
<section id="slide-org9f7c124" data-background="./assets/slide_background.png">
<h3 id="org9f7c124">Create REST Endpoints</h3>

</section>
</section>
<section>
<section id="slide-orgcde2b43" data-background="./assets/slide_background.png">
<h2 id="orgcde2b43">Discussion</h2>
<div class="outline-text-2" id="text-orgcde2b43">
</div>
</section>
<section id="slide-org7cf80ca" data-background="./assets/slide_background.png">
<h3 id="org7cf80ca">GraphQL Security Orthodoxy</h3>
<p>
AKA: rituals, cargo cults, security theater which you can get anywhere
</p>
<ul>
<li>Disable Console Access</li>
<li>Disable Schema Introspection</li>
<li>Disable Query Suggestions (unneccessary in Hasura)</li>
<li>Impose API Limits</li>
<li>Whitelist Operations</li>

</ul>

</section>
<section id="slide-orga0e6272" data-background="./assets/slide_background.png">
<h3 id="orga0e6272">GraphQL Security Heterodoxy</h3>
<p>
AKA: possibly controversial opinions which you will get from me
</p>
<ul>
<li>Don't confuse public vs private:</li>
<li>If you don't <i>need</i> to provide a public API, then don't.</li>
<li>If you're not providing a public API, then don't act like you are.</li>
<li>Don't disable console access</li>
<li>If you applied the security principles carefully, deliberately, thoughtfully, then the console can't do anything unauthorized anyway.</li>
<li>Don't disable schema introspection and query suggestions.</li>
<li>The public will need to know how to use your public API (which you almost certainly shouldn't have anyway)</li>
<li>The public shouldn't have access to your private API (you did secure your API, add authentication, disable unauthorized access, build a rich data model, and apply fine-graned authorization, didn't you?)</li>
<li>The information will get out anyway.</li>
<li>Don't use GraphQL security</li>
<li>Or at least, don't rely on it.</li>
<li>Work diligently from the bottom-up, applying the principles carefully, deliberately, thoughtfully, and you (almost) won't need it.</li>
<li>Remember "managing risk", "cargo cults", and "security theater".</li>

</ul>
<p>
Life is about trade-offs.
</p>
<ul>
<li>Don't use GraphQL</li>
<li>For private APIs, that is.</li>
<li>Use Allow Lists.</li>
<li>And if you're using Allow Lists, you might as well use REST endpoints.</li>
<li>GraphQL is for <i>people</i> (i.e. developers), not for machines.</li>

</ul>

</section>
</section>
<section>
<section id="slide-orge4b355e" data-background="./assets/slide_background.png">
<h2 id="orge4b355e">Closing Remarks</h2>
<div class="outline-text-2" id="text-orge4b355e">
</div>
</section>
<section id="slide-org5b190df" data-background="./assets/slide_background.png">
<h3 id="org5b190df">References</h3>

</section>
<section id="slide-org4803e49" data-background="./assets/slide_background.png">
<h3 id="org4803e49">How and where to get help</h3>
<p>
white<sub>check</sub><sub>mark</sub>
100
raised<sub>hands</sub>
</p>
</section>
</section>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/markdown/markdown.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealMarkdown, RevealZoom, RevealNotes],
transition:'none', controlsLayout:'edges', progress:false, controlsTutorial:false
});

</script>
</body>
</html>
