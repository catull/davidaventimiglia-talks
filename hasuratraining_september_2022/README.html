<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Hasura Training</title>
<meta name="author" content="David A. Ventimiglia"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/black.css" id="theme"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/lib/css/zenburn.css"/></head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="./assets/slide_background.png"><h1 class="title">Hasura Training</h1><p class="subtitle">Zen and the Art of Hasura</p>

</section>

<section>
<section id="slide-org3d4a7a7" data-background="./assets/slide_background.png">
<h2 id="org3d4a7a7"></h2>

<div class="figure">
<p><img src="assets/qr.png" alt="qr.png" height="40%" width="40%" />
</p>
<p><span class="figure-number">Figure 1: </span><a href="https://tinyurl.com/ynhbbrmy">https://tinyurl.com/ynhbbrmy</a></p>
</div>


</section>
</section>
<section>
<section id="slide-org4bbc076" data-background="./assets/slide_background.png">
<h2 id="org4bbc076">Who</h2>
<blockquote >
<p>
"I'm a physicist, data scientist, data engineer, and software
engineer.  I work for <a href="https://hasura.io/"><b>Hasura</b></a>, a software technology company that
provides developer-focused tooling products.  And, I believe that the
best code is the code that you don't have to write."
</p>
</blockquote>

</section>
</section>
<section>
<section id="slide-orgf096abc" data-background="./assets/slide_background.png">
<h2 id="orgf096abc">What</h2>
</section>
<section id="slide-orgf096abc-split" data-background="./assets/slide_background.png">

<blockquote >
<p>
"From your databases to a unified GraphQL API in just one minute"
</p>
</blockquote>

</section>
</section>
<section>
<section id="slide-org093117c" data-background="./assets/slide_background.png">
<h2 id="org093117c">What?</h2>
<div class="outline-text-2" id="text-org093117c">
</div>
</section>
<section id="slide-org103faaf" data-background="./assets/slide_background.png">
<h3 id="org103faaf">GraphQL API</h3>
<div class="column" style="float:left; width:50%">

<ul>
<li>Query Language</li>
<li>Schema
<ul>
<li>Types
<ul>
<li>Fields</li>

</ul></li>

</ul></li>
<li>Types relate to Types</li>
<li>Sound familiar?</li>

</ul>

</div>

<div class="column" style="float:right; width:50%;">


<div class="figure">
<p><img src="GraphQL.png" alt="GraphQL.png" height="100%" width="100%" />
</p>
</div>

</div>

</section>
<section id="slide-orgcea3a49" data-background="./assets/slide_background.png">
<h3 id="orgcea3a49">In Just One Minute</h3>

<div class="figure">
<p><img src="Hasura_Connections.png" alt="Hasura_Connections.png" height="50%" width="50%" />
</p>
</div>

</section>
<section id="slide-orgcea3a49-split" data-background="./assets/slide_background.png">


<div class="figure">
<p><img src="what_is_hasura.png" alt="what_is_hasura.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-org1497fc9" data-background="./assets/slide_background.png">
<h2 id="org1497fc9">How</h2>
<div class="outline-text-2" id="text-org1497fc9">
</div>
</section>
<section id="slide-org1a11ec9" data-background="./assets/slide_background.png">
<h3 id="org1a11ec9">What You Will Need</h3>
<div class="column" style="float:left; width:50%">


<div class="figure">
<p><img src="assets/log_into_hasura_cloud.png" alt="log_into_hasura_cloud.png" height="90%" width="90%" />
</p>
</div>

<p>
<a href="http://cloud.hasura.io">http://cloud.hasura.io</a>
</p>

</div>

<div class="column" style="float:right; width:40%;">


<div class="figure">
<p><img src="assets/log_into_heroku.png" alt="log_into_heroku.png" height="80%" width="80%" />
</p>
</div>

<p>
<a href="https://cloud.hasura.io/">https://cloud.hasura.io/</a>
</p>

</div>

</section>
<section id="slide-orgf47b33a" data-background="./assets/slide_background.png">
<h3 id="orgf47b33a">What We Will Cover</h3>
<ul>
<li>What is Hasura?</li>
<li>How do we use them?</li>
<li>How do we use them well?</li>
<li>What are the general principles?</li>
<li>What are the particular details?</li>
<li>What is the proper mental model?</li>
<li>How do we get there?</li>

</ul>

</section>
<section id="slide-orgb907b00" data-background="./assets/slide_background.png">
<h3 id="orgb907b00">What is Hasura?</h3>
<ul>
<li>API Server</li>
<li>Development Environment</li>

</ul>

</section>
<section id="slide-org8dbb23d" data-background="./assets/slide_background.png">
<h3 id="org8dbb23d">What is Hasura?</h3>
<p>
Magic
</p>

</section>
<section id="slide-org19d3551" data-background="./assets/slide_background.png">
<h3 id="org19d3551">How do we use them?</h3>
<ul>
<li>Build network applications <i><b>faster</b></i>, more <i><b>reliably</b></i>, and <i><b>cheaper</b></i> with GraphQL.</li>
<li>Build GraphQL applications <i><b>faster</b></i>, more <i><b>reliably</b></i>, and <i><b>cheaper</b></i> with Hasura.</li>
<li>Apply the general principles with training from <i><b>Hasura Developer Relations</b></i>.</li>
<li>Apply the particular details with support from <i><b>Hasura Developer Success</b></i>.</li>

</ul>

</section>
<section id="slide-org35f4e38" data-background="./assets/slide_background.png">
<h3 id="org35f4e38">How do we use them well?</h3>
<ul>
<li>Adopt a principled approach.</li>
<li>Develop a proper mental model.</li>

</ul>

</section>
<section id="slide-orga437a86" data-background="./assets/slide_background.png">
<h3 id="orga437a86">What are the general principles?</h3>
<ol>
<li>Build for humans.</li>
<li>Build with personas.</li>
<li>Build in the database.</li>
<li>Build a data model.</li>
<li>Remember OLTP vs OLAP.</li>

</ol>

</section>
<section id="slide-org92b5f70" data-background="./assets/slide_background.png">
<h3 id="org92b5f70">What is the proper mental model?</h3>
<ul>
<li>Hasura <code>graphql-engine</code> is the API server, is on the data plane, and is on the critical path.</li>
<li>Hasura <code>console</code> is part of the development environment, is on the control plane, and is off the critical path.</li>
<li>Hasura <code>CLI</code> is part of the development environment, is on the control plane, and is far off the critical path.</li>

</ul>

</section>
<section id="slide-org8a66427" data-background="./assets/slide_background.png">
<h3 id="org8a66427">What is the proper mental model?</h3>
<ul>
<li>The key functional concerns are: data modeling, API development, security, and integrations.</li>
<li>The key non-functional concerns are: deployment, caching, monitoring.</li>

</ul>

</section>
<section id="slide-org4cb3db4" data-background="./assets/slide_background.png">
<h3 id="org4cb3db4">How do we get there?</h3>
<ul>
<li>Track 1: Development</li>
<li>Track 2: Deployment</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgdcba425" data-background="./assets/slide_background.png">
<h2 id="orgdcba425">Track 1: Development</h2>
<div class="outline-text-2" id="text-orgdcba425">
</div>
</section>
<section id="slide-org1ea40bb" data-background="./assets/slide_background.png">
<h3 id="org1ea40bb">Setup</h3>

</section>
<section id="slide-org7e030ba" data-background="./assets/slide_background.png">
<h3 id="org7e030ba">Modeling</h3>

</section>
<section id="slide-org7e9943f" data-background="./assets/slide_background.png">
<h3 id="org7e9943f">Security</h3>

</section>
<section id="slide-orgcc19d8a" data-background="./assets/slide_background.png">
<h3 id="orgcc19d8a">Actions</h3>

</section>
<section id="slide-org3ad225e" data-background="./assets/slide_background.png">
<h3 id="org3ad225e">Events</h3>

</section>
<section id="slide-orgbd84244" data-background="./assets/slide_background.png">
<h3 id="orgbd84244">APIs</h3>

</section>
<section id="slide-org6ddf35b" data-background="./assets/slide_background.png">
<h3 id="org6ddf35b">Remote Joins</h3>

</section>
<section id="slide-org6bc9fd1" data-background="./assets/slide_background.png">
<h3 id="org6bc9fd1">Remote Schema</h3>

</section>
</section>
<section>
<section id="slide-org681509e" data-background="./assets/slide_background.png">
<h2 id="org681509e">Track 2: Deployment</h2>
<div class="outline-text-2" id="text-org681509e">
</div>
</section>
<section id="slide-org104f40a" data-background="./assets/slide_background.png">
<h3 id="org104f40a">Self-Hosted vs Cloud</h3>

</section>
<section id="slide-orgd06746f" data-background="./assets/slide_background.png">
<h3 id="orgd06746f">Development Environment</h3>

</section>
<section id="slide-orgb16a4dc" data-background="./assets/slide_background.png">
<h3 id="orgb16a4dc">CI/CD</h3>

</section>
</section>
<section>
<section id="slide-orgdc266a4" data-background="./assets/slide_background.png">
<h2 id="orgdc266a4">Databases</h2>
<div class="outline-text-2" id="text-orgdc266a4">
</div>
</section>
<section id="slide-org86ce966" data-background="./assets/slide_background.png">
<h3 id="org86ce966">Postgres</h3>
<div class="outline-text-3" id="text-org86ce966">
</div>
</section>
<section id="slide-orgbd74b98" data-background="./assets/slide_background.png">
<h4 id="orgbd74b98">Schema</h4>
<div class="outline-text-4" id="text-orgbd74b98">
</div>
<ul class="org-ul">
<li><a id="orge2435b1"></a><span class="done DONE">DONE</span> Table Basics<br />
<ul>
<li class="on"><code>[X]</code> Add database</li>
<li class="on"><code>[X]</code> Add account and product tables</li>
<li class="on"><code>[X]</code> Add account and product data</li>
<li class="on"><code>[X]</code> Perform CRUD operations
<ul>
<li><p>
Read
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  account(order_by: {name: asc}, limit: 10) {
    id
    name
    created_at
    updated_at
  }
}
</code></pre>
</div>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  product(order_by: {price: asc}, limit: 10) {
    id
    name
    price
    updated_at
    created_at
  }
}
</code></pre>
</div></li>
<li><p>
Insert
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >mutation MyMutation {
  insert_account(objects: {name: "John Doe"}) {
    affected_rows
  }
}
</code></pre>
</div>
<div class="org-src-container">

<pre   ><code class="graphql" >mutation MyMutation {
  insert_product(objects: {name: "Doughnut", price: 100}) {
    returning {
      id
      name
      price
      updated_at
      created_at
    }
  }
}
</code></pre>
</div></li>
<li><p>
Update
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >mutation MyMutation {
  update_account(where: {name: {_eq: "John Doe"}}, _set: {name: "Jane Doe"}) {
    affected_rows
  }
}
</code></pre>
</div></li>
<li><p>
Delete
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >mutation MyMutation {
    delete_product(where: {name: {_eq: "Doughnut"}}) {
      affected_rows
    }
  }
</code></pre>
</div></li>

</ul></li>

</ul>
</li>
<li><a id="orgfa251d6"></a><span class="done DONE">DONE</span> Table Relationships<br />
<ul>
<li class="on"><code>[X]</code> Add the order and order detail tables</li>
<li class="on"><code>[X]</code> Add relationships for account, order, order detail, and product</li>
<li class="on"><code>[X]</code> Generate order and order detail data</li>
<li class="on"><code>[X]</code> <p>
Perform queries across relationships
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  account(limit: 2) {
    id
    name
    created_at
    updated_at
    orders {
      id
      created_at
      updated_at
      order_details {
	id
	created_at
	updated_at
	units
	product {
	  id
	  name
	  created_at
	  updated_at
	  price
	}
      }
    }
  }
}
</code></pre>
</div></li>

</ul>
</li>
<li><a id="orgf815e7b"></a><span class="done DONE">DONE</span> Remote Relationships&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
<li><a id="orgbef1eac"></a><span class="done DONE">DONE</span> Extend with Views<br />
<ul>
<li class="on"><code>[X]</code> Add account<sub>summary</sub> view and relationships</li>
<li class="on"><code>[X]</code> <p>
Query across table and view relationships
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  account_summary(limit: 10) {
    id
    sum
    account {
      name
    }
  }
}
</code></pre>
</div></li>

</ul>
</li>
<li><a id="orgd74defc"></a><span class="done DONE">DONE</span> Extend with SQL Functions<br />
<ul>
<li class="on"><code>[X]</code> Add search functions</li>
<li class="on"><code>[X]</code> <p>
Query search functions
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  product_search(args: {search: "apple"}) {
    name
    price
  }
}
</code></pre>
</div>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  product_fuzzy_search(args: {search: "apple"}) {
    name
    price
  }
}
</code></pre>
</div></li>

</ul>
</li>
<li><a id="org82ab346"></a><span class="done DONE">DONE</span> Default field values<br /></li>
<li><a id="org67f1752"></a><span class="done DONE">DONE</span> Enum type fields<br />
<ul>
<li class="on"><code>[X]</code> Create a native Postgres enum type for order status.</li>
<li class="on"><code>[X]</code> Create a enum table for region and track it as order sales<sub>region</sub>.</li>

</ul>
</li>
<li><a id="org53afb12"></a><span class="done DONE">DONE</span> Computed fields<br />
<ul>
<li class="on"><code>[X]</code> Add product<sub>sku</sub> function and track it as a computed field</li>
<li class="on"><code>[X]</code> Query product table with computed field</li>

</ul>
<div class="org-src-container">

<pre   ><code class="graphql" >query {
  product(limit: 10) {
    id
    name
    price
    sku
  }
}
</code></pre>
</div>
</li>

<li><a id="org47488ac"></a><span class="done DONE">DONE</span> Customize auto-generated fields&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br />
<ul>
<li class="on"><code>[X]</code> Change order.status to order.state for the GraphQL field name</li>

</ul>
</li>
<li><a id="org31f48d9"></a><span class="done DONE">DONE</span> Data validations<br />
<ul>
<li class="on"><code>[X]</code> Add non<sub>negative</sub><sub>price</sub> check constraint</li>
<li class="on"><code>[X]</code> <p>
Attempt mutations with and without negative prices
</p>
<div class="org-src-container">

<pre   ><code class="graphql" >mutation MyMutation {
  update_product(where: {name: {_eq: "Chilli Paste, Sambal Oelek"}}, _set: {price: 10}) {
    affected_rows
  }
}
</code></pre>
</div>
<div class="org-src-container">

<pre   ><code class="graphql" >mutation MyMutation {
  update_product(where: {name: {_eq: "Pastry - Raisin Muffin - Mini"}}, _set: {price: -10}) {
    affected_rows
  }
}
</code></pre>
</div></li>

</ul>
</li>
<li><a id="orge28c68d"></a><span class="done DONE">DONE</span> Using an existing database<br /></li>
<li><a id="org1dfe8f4"></a><span class="done DONE">DONE</span> Relay Schema&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br />
<ul>
<li class="on"><code>[X]</code> Turn on the Relay API in the Console</li>

</ul>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  account_connection(first: 10) {
    edges {
      node {
	name
	orders {
	  id
	  region
	  order_details {
	    units
	    product {
	      name
	      price
	      sku
	    }
	  }
	}
      }
      cursor
    }
  }
}
</code></pre>
</div>
</li>
</ul>
</section>
<section id="slide-org93053a6" data-background="./assets/slide_background.png">
<h4 id="org93053a6">Queries</h4>
<div class="outline-text-4" id="text-org93053a6">
</div>
<ul class="org-ul">
<li><a id="org65c630c"></a><span class="done DONE">DONE</span> Simple object queries<br /></li>
<li><a id="orgddc5f38"></a><span class="done DONE">DONE</span> Nested object queries<br /></li>
<li><a id="org8f29011"></a><span class="done DONE">DONE</span> Aggregation queries<br />
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  account_aggregate {
    aggregate {
      count
    }
  }
}
</code></pre>
</div>
<div class="org-src-container">

<pre   ><code class="graphql" >query MyQuery {
  account(limit: 10) {
    orders {
      order_details_aggregate {
	aggregate {
	  sum {
	    units
	  }
	}
      }
    }
  }
}
</code></pre>
</div>
</li>
<li><a id="org3a9ebbb"></a><span class="done DONE">DONE</span> Filter query results / search queries<br /></li>
<li><a id="org1374ba2"></a><span class="done DONE">DONE</span> Sort query results<br /></li>
<li><a id="orgdd0507b"></a><span class="done DONE">DONE</span> Distinct query results<br /></li>
<li><a id="orgb7adbf7"></a><span class="todo TODO">TODO</span> Using multiple arguments&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
<li><a id="org94ef00e"></a><span class="todo TODO">TODO</span> Multiple queries in a request&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
<li><a id="org229fafd"></a><span class="todo TODO">TODO</span> Using variables / aliases / fragments / directives&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
<li><a id="orgd9c9cf8"></a><span class="todo TODO">TODO</span> Query performance<br /></li>
</ul>
</section>
<section id="slide-orge59d395" data-background="./assets/slide_background.png">
<h4 id="orge59d395">Mutations</h4>
<div class="outline-text-4" id="text-orge59d395">
</div>
<ul class="org-ul">
<li><a id="orgf661697"></a><span class="done DONE">DONE</span> Insert<br /></li>
<li><a id="orga091330"></a><span class="todo TODO">TODO</span> Upsert<br /></li>
<li><a id="org2f826e9"></a><span class="done DONE">DONE</span> Update<br /></li>
<li><a id="orgc350ce6"></a><span class="todo TODO">TODO</span> Delete<br /></li>
<li><a id="orgeb03c23"></a><span class="todo TODO">TODO</span> Multiple mutations in a request<br /></li>
</ul>
</section>
<section id="slide-org42ca381" data-background="./assets/slide_background.png">
<h4 id="org42ca381">Subscriptions</h4>
<div class="outline-text-4" id="text-org42ca381">
</div>
<ul class="org-ul">
<li><a id="org2068f34"></a><span class="todo TODO">TODO</span> Live queries<br /></li>
</ul>
</section>
<section id="slide-org6bb0640" data-background="./assets/slide_background.png">
<h4 id="org6bb0640">Supported Postgres types</h4>
<div class="outline-text-4" id="text-org6bb0640">
</div>
<ul class="org-ul">
<li><a id="org8d50063"></a><span class="done DONE">DONE</span> Perform inserts on the <code>misc</code> table.<br />
<div class="org-src-container">

<pre   ><code class="graphql" >mutation {
  insert_misc(objects: [
      {
	bigint_field: 1
	bigserial_field: 1
	boolean_field: true
	box_field: "((0,0),(1,1))"
	bytea_field: "\\xDEADBEEF"
	character_field: "foo"
	character_varying_field: "bar"
	cidr_field: "192.168.100.128/25"
	circle_field: "0,0,1"
	date_field: "2022-01-01"
	double_precision_field: 9673143120,
	inet_field: "192.168.0.1/24"
	integer_field: 1
	interval_field: "'1 month ago'"
	json_field: {}
	jsonb_field: {}
	line_field: "0,0,1,1"
	lseg_field: "0,0,1,1"
	macaddr_field: "08:00:2b:01:02:03"
	macaddr8_field: "08:00:2b:01:02:03:04:05"
	money_field: 52093.89
	numeric_field: 10
	path_field: "0,0,1,1,2,2,3,3,3,0,2,0,0,0"
	pg_lsn_field: "FFFFFFFF/FFFFFFFF"
	point_field: "0,0"
	polygon_field: "0,0,1,0,1,1,0,1"
	real_field: 3.14159
	serial_field: 1
	smallint_field: 1
	smallserial_field: 1
	text_field: "abc"
	time_with_time_zone_field: "04:05:06 PST"
	time_without_time_zone_field: "04:05:06"
	timestamp_with_time_zone_field: "2022-01-01 04:05:06 PST"
	timestamp_without_time_zone_field: "2022-01-01 04:05:06"
	txid_snapshot_field: "566:566:"
	uuid_field: "61a41be6-4eb4-45a5-bfb5-b68c20e9ccde"
	xml_field: "&lt;?xml version=\"1.0\"?&gt;&lt;book&gt;&lt;title&gt;Manual&lt;/title&gt;&lt;chapter&gt;...&lt;/chapter&gt;&lt;/book&gt;"
      }
    ]) {
    returning {
      bigint_field
      bigserial_field
      boolean_field
      box_field
      bytea_field
      character_field
      character_varying_field
      cidr_field
      circle_field
      date_field
      double_precision_field
      inet_field
      integer_field
      interval_field
      json_field
      jsonb_field
      line_field
      lseg_field
      macaddr_field
      macaddr8_field
      money_field
      numeric_field
      path_field
      pg_lsn_field
      point_field
      polygon_field
      real_field
      serial_field
      smallint_field
      smallserial_field
      text_field
      time_with_time_zone_field
      time_without_time_zone_field
      timestamp_with_time_zone_field
      timestamp_without_time_zone_field
      txid_snapshot_field
      uuid_field
      xml_field
    }
  }
}
</code></pre>
</div>
</li>
</ul>

</section>
</section>
<section>
<section id="slide-org30cda10" data-background="./assets/slide_background.png">
<h2 id="org30cda10">Remote Schema</h2>
<div class="outline-text-2" id="text-org30cda10">
</div>
</section>
<section id="slide-orge76497a" data-background="./assets/slide_background.png">
<h4 id="orge76497a">Remote relationships</h4>
<div class="outline-text-4" id="text-orge76497a">
</div>
<ul class="org-ul">
<li><a id="orgd53e25a"></a><span class="todo TODO">TODO</span> To remote database<br /></li>
<li><a id="orgd698ae4"></a><span class="todo TODO">TODO</span> To Remote Schema&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
</ul>
</section>
<section id="slide-orgded3e95" data-background="./assets/slide_background.png">
<h4 id="orgded3e95">Authorization in remote schema</h4>
<div class="outline-text-4" id="text-orgded3e95">
</div>
<ul class="org-ul">
<li><a id="org7d4ecc6"></a><span class="todo TODO">TODO</span> Forwarding auth context to/from remote schema&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
<li><a id="org646f45a"></a><span class="todo TODO">TODO</span> Remote schema permissions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
<li><a id="orge9e61c3"></a><span class="todo TODO">TODO</span> Bypassing Hasura's auth for remote schema&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DOES_NOT_INVOLVE_DB">DOES_NOT_INVOLVE_DB</span></span><br /></li>
</ul>
</section>
</section>
<section>
<section id="slide-orge83dbb2" data-background="./assets/slide_background.png">
<h2 id="orge83dbb2">Event Triggers</h2>
<div class="outline-text-2" id="text-orge83dbb2">
</div>
</section>
<section id="slide-org765c946" data-background="./assets/slide_background.png">
<h4 id="org765c946">Creating an Event Trigger</h4>
<div class="outline-text-4" id="text-org765c946">
</div>
<ul class="org-ul">
<li><a id="orgf0c2803"></a><span class="done DONE">DONE</span> Create an insert trigger<br /></li>
<li><a id="orgd7913f1"></a><span class="done DONE">DONE</span> Create an update trigger<br />
<ul>
<li class="off"><code>[&#xa0;]</code> Perform a mutation to update an order</li>
<li class="off"><code>[&#xa0;]</code> Update an order from the Console</li>

</ul>
<div class="org-src-container">

<pre   ><code class="graphql" >mutation MyMutation {
  update_order_by_pk(pk_columns: {id: "1564344e-e528-43de-b88e-dab9c3efa44e"}, _set: {state: "fulfilled"}) {
    id
    state
  }
}
</code></pre>
</div>
<ul>
<li class="off"><code>[&#xa0;]</code> Check the events logs</li>

</ul>
</li>
</ul>
</section>
</section>
<section>
<section id="slide-org206653a" data-background="./assets/slide_background.png">
<h2 id="org206653a">Scheduled Triggers</h2>
<div class="outline-text-2" id="text-org206653a">
</div>
</section>
<section id="slide-org2f9a863" data-background="./assets/slide_background.png">
<h4 id="org2f9a863">Creating a chron trigger</h4>
<div class="outline-text-4" id="text-org2f9a863">
</div>
<ul class="org-ul">
<li><a id="orgc692930"></a><span class="todo TODO">TODO</span> Create a chron trigger<br />
<ul>
<li class="off"><code>[&#xa0;]</code> Allow time to pass</li>
<li class="off"><code>[&#xa0;]</code> Check the events logs</li>

</ul>
</li>
</ul>
</section>
<section id="slide-orgc64a88c" data-background="./assets/slide_background.png">
<h4 id="orgc64a88c">Creating a one-off scheduled event</h4>
<div class="outline-text-4" id="text-orgc64a88c">
</div>
<ul class="org-ul">
<li><a id="org4b90cbd"></a><span class="todo TODO">TODO</span> Create a one-off scheduled event<br /></li>
</ul>
</section>
<section id="slide-orgd9c54f1" data-background="./assets/slide_background.png">
<h4 id="orgd9c54f1">Cleaning up scheduled triggers data</h4>
<div class="outline-text-4" id="text-orgd9c54f1">
</div>
<ul class="org-ul">
<li><a id="orgb047abf"></a><span class="todo TODO">TODO</span> Clear Everything<br />
<ul>
<li class="off"><code>[&#xa0;]</code> <p>
Cron triggers
</p>

<div class="org-src-container">

<pre   ><code class="sql" >DELETE FROM hdb_catalog.hdb_cron_events;
</code></pre>
</div></li>

<li class="off"><code>[&#xa0;]</code> <p>
Scheduled events
</p>

<div class="org-src-container">

<pre   ><code class="sql" >DELETE FROM hdb_catalog.hdb_scheduled_events;
</code></pre>
</div></li>

</ul>
</li>
</ul>
</section>
</section>
<section>
<section id="slide-org7b266c0" data-background="./assets/slide_background.png">
<h2 id="org7b266c0">Test Matrix</h2>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">Test</th>
<th scope="col" class="org-left">Outcome</th>
<th scope="col" class="org-left">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Remote Relationships</td>
<td class="org-left">NO</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Remote Schema connect to GraphQL servers</td>
</tr>

<tr>
<td class="org-left">Add Database</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Add tables and relationships in Console</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Perform CRUD operations in API</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Set up and use table relationships</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Track views</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Manually add relationships to views</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Query across view/table relationships</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Track a function as a table and use</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Track a function as a computed field and use</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Use defaults for field values</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Use a native enum as a Hasura enum</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Use a table as a Hasura enum</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Customize field-names in API</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">Doesn't actually involve the DB</td>
</tr>

<tr>
<td class="org-left">Data validation with a database constraint</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Test using the Relay API</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">Doesn't actually involve the DB</td>
</tr>

<tr>
<td class="org-left">Simple object queries</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Nested object queries (involves JOINs)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Aggregation queries (count)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">We didn't test min, max, avg, etc.</td>
</tr>

<tr>
<td class="org-left">Filter queries (involves WHERE)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Sort queries (involves ORDER BY)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Distinct queries (involves DISTINCT)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Limit queries (involves LIMIT)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Using multiple arguments</td>
<td class="org-left">NO</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Doesn't actually involve the DB</td>
</tr>

<tr>
<td class="org-left">Multiple queries in a request</td>
<td class="org-left">NO</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Doesn't actually involve the DB</td>
</tr>

<tr>
<td class="org-left">Multiple variables / aliases / fragments / directives</td>
<td class="org-left">NO</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Doesn't actually involve the DB</td>
</tr>

<tr>
<td class="org-left">INSERT (see "Perform CRUD operations in API" above</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UPDATE (see "Perform CRUD operations in API" above</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DELETE (see "Perform CRUD operations in API" above</td>
<td class="org-left">TBD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">We forgot to test this!</td>
</tr>

<tr>
<td class="org-left">ON CONFLICT (an "upsert")</td>
<td class="org-left">TBD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">We forgot to test this!</td>
</tr>

<tr>
<td class="org-left">Multiple mutations in a request</td>
<td class="org-left">TBD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">We forgot to test this!</td>
</tr>

<tr>
<td class="org-left">Subscriptions (Live Queries)</td>
<td class="org-left">TBD</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Test all Postgres/Hasura types (mutation, query)</td>
<td class="org-left">TBD</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Remote Database</td>
<td class="org-left">TBD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">We forgot to test this!</td>
</tr>

<tr>
<td class="org-left">Creating event triggers</td>
<td class="org-left">YES</td>
<td class="org-left">FAIL</td>
<td class="org-left">Needs a Hasura fix. See Notes below</td>
</tr>

<tr>
<td class="org-left">Creating a chron trigger</td>
<td class="org-left">TBD</td>
<td class="org-left">FAIL</td>
<td class="org-left">Needs a Hasura fix. See Notes below</td>
</tr>

<tr>
<td class="org-left">Creating a one-off scheduled event</td>
<td class="org-left">TBD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Needs a Hasura fix</td>
</tr>

<tr>
<td class="org-left">Cleaning up scheduled trigger data</td>
<td class="org-left">TBD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Needs a Hasura fix</td>
</tr>

<tr>
<td class="org-left">CI/CD: hasura metadata (apply, clear, reload, status)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CI/CD: hasura migrate (apply, apply &#x2013;down all, delete)</td>
<td class="org-left">YES</td>
<td class="org-left">SUCCESS</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

</section>
<section id="slide-org25586cb" data-background="./assets/slide_background.png">
<h4 id="org25586cb">NOTES</h4>
<dl>
<dt>Test</dt><dd>do we test this (YES, NO, TBD)</dd>
<dt>YES</dt><dd>we should test this (and have)</dd>
<dt>NO</dt><dd>we may not need to test this</dd>
<dt>TBD</dt><dd>we should test this (but have not yet, possibly because we
cannot)</dd>
<dt>SUCCESS</dt><dd>we tested it and it passed</dd>
<dt>FAIL</dt><dd>we tested it and it did not pass</dd>
<dt>"We forgot to test this!"</dt><dd>either we forgot, or we suspect we may
not need to (e.g. "Remote Database")</dd>
<dt>"Doesn't actually involve the DB"</dt><dd>a Hasura function which we
believe shouldn't work differently on BDR, since the function
doesn't actually interact with the database.</dd>
<dt>"Needs a Hasura fix"</dt><dd>either we have a FAIL test or a TBD test,
because of an identified gap in Hasura that needs to be fixed.</dd>

</dl>

</section>
<section id="slide-org8160565" data-background="./assets/slide_background.png">
<h4 id="org8160565">Additional Notes</h4>
<ol>
<li>Event Trigger creation fails with the following error:</li>

</ol>

<div class="org-src-container">

<pre   ><code class="json" >{
    "internal": {
	"statement": "\n  INSERT INTO hdb_catalog.hdb_source_catalog_version(version, upgraded_on)\n    VALUES ($1, NOW())\n   ON CONFLICT ((version IS NOT NULL))\n   DO UPDATE SET version = $1, upgraded_on = NOW()\n  ",
	"prepared": false,
	"error": {
	    "exec_status": "FatalError",
	    "hint": "To enable updating the table, set REPLICA IDENTITY using ALTER TABLE.",
	    "message": "cannot run INSERT ON CONFLICT DO UPDATE on table \"hdb_source_catalog_version\" because it does not have a replica identity and is part of replication set which publishes updates",
	    "status_code": "55000",
	    "description": null
	},
	"arguments": [
	    "(Oid 25,Just (\"2\",Binary))"
	]
    },
    "path": "$.args[0].args",
    "error": "database query error",
    "code": "unexpected"
}
</code></pre>
</div>

<ol>
<li>Cannot alter table with volatile function.  This error is the result of trying to add a UUID column to an existing table:</li>

</ol>

<div class="org-src-container">

<pre   ><code class="json" >{
    "internal": {
	"statement": "CREATE EXTENSION IF NOT EXISTS pgcrypto;\nalter table \"public\"."\misc\" add colum \"id\" uuid\n not null unique default gen_random_uuid():\n",
	"prepared": false,
	"error": {
	    "exec_status": "FatalError",
	    "hint": "null.",
	    "message": "ALTER TABLE ... ADD COLUMN ... (mutable) DEFAULT may not affect replicated tables on a BDR node",
	    "status_code": "0A000",
	    "description": null
	},
	"arguments": []
    },
    "path": "$",
    "error": "query execution failed",
    "code": "postgres-error"
}
</code></pre>
</div>

<p>
Workaround is detailed in <a href="https://www.enterprisedb.com/docs/pgd/latest/bdr/ddl/#adding-a-column">https://www.enterprisedb.com/docs/pgd/latest/bdr/ddl/#adding-a-column</a>
</p>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/plugin/highlight/highlight.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealHighlight],
transition:'none', controlsLayout:'edges', progress:false, controlsTutorial:false
});

</script>
</body>
</html>
